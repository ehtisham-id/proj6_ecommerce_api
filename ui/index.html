<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium E-Commerce Store</title>
    
    <!-- External CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light);
        }

        .navbar {
            background: linear-gradient(135deg, var(--dark) 0%, #334155 100%);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: white !important;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.7rem;
        }

        .hero-section {
            background: linear-gradient(135deg, var(--primary) 0%, #1d4ed8 100%);
            color: white;
            padding: 80px 0;
        }

        .product-card {
            transition: all 0.3s ease;
            border: none;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .product-image {
            height: 250px;
            object-fit: cover;
            background: #e2e8f0;
        }

        .price-tag {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .btn-primary {
            background: var(--primary);
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
        }

        .category-pill {
            display: inline-block;
            padding: 8px 20px;
            margin: 4px;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
        }

        .category-pill:hover, .category-pill.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .star-rating {
            color: #fbbf24;
        }

        .modal-content {
            border-radius: 16px;
            border: none;
        }

        .cart-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .checkout-summary {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .order-timeline {
            position: relative;
            padding-left: 30px;
        }

        .order-timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e2e8f0;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }

        .timeline-dot {
            position: absolute;
            left: -24px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
        }

        .footer {
            background: var(--dark);
            color: white;
            padding: 40px 0 20px;
            margin-top: 80px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="fas fa-store me-2"></i>Premium Store</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('home')">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('products')">Products</a>
                    </li>
                    <li class="nav-item me-3">
                        <div class="input-group" style="width: 250px;">
                            <input type="text" class="form-control form-control-sm" id="searchInput" placeholder="Search products...">
                            <button class="btn btn-light btn-sm" onclick="searchProducts()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </li>
                    <li class="nav-item position-relative me-3">
                        <a class="nav-link" href="#" onclick="showCart()">
                            <i class="fas fa-shopping-cart fa-lg"></i>
                            <span class="cart-badge" id="cartCount">0</span>
                        </a>
                    </li>
                    <li class="nav-item dropdown" id="userMenu" style="display: none;">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle fa-lg"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" onclick="showPage('profile')">Profile</a></li>
                            <li><a class="dropdown-item" href="#" onclick="showPage('orders')">My Orders</a></li>
                            <li><a class="dropdown-item" href="#" onclick="showPage('notifications')">Notifications</a></li>
                            <li id="sellerMenuItem" style="display: none;"><hr class="dropdown-divider"></li>
                            <li id="sellerMenuLink" style="display: none;"><a class="dropdown-item" href="#" onclick="showPage('seller')"><i class="fas fa-store me-2"></i>Seller Dashboard</a></li>
                            <li id="adminMenuItem" style="display: none;"><hr class="dropdown-divider"></li>
                            <li id="adminMenuLink" style="display: none;"><a class="dropdown-item" href="#" onclick="showPage('admin')"><i class="fas fa-shield-alt me-2"></i>Admin Panel</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()">Logout</a></li>
                        </ul>
                    </li>
                    <li class="nav-item" id="authButtons">
                        <button class="btn btn-outline-light btn-sm me-2" onclick="showLoginModal()">Login</button>
                        <button class="btn btn-light btn-sm" onclick="showRegisterModal()">Sign Up</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Main Content -->
    <div id="mainContent">
        <!-- Home Page -->
        <div id="homePage">
            <!-- Hero Section -->
            <section class="hero-section">
                <div class="container text-center" data-aos="fade-up">
                    <h1 class="display-3 fw-bold mb-4 animate__animated animate__fadeInDown">Welcome to Premium Store</h1>
                    <p class="lead mb-5 animate__animated animate__fadeInUp">Discover amazing products at unbeatable prices</p>
                    <button class="btn btn-light btn-lg" onclick="showPage('products')">
                        Shop Now <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </section>

            <!-- Categories -->
            <section class="py-5">
                <div class="container">
                    <h2 class="text-center mb-4" data-aos="fade-up">Shop by Category</h2>
                    <div id="categoriesHome" class="text-center"></div>
                </div>
            </section>

            <!-- Featured Products -->
            <section class="py-5 bg-white">
                <div class="container">
                    <h2 class="text-center mb-5" data-aos="fade-up">Featured Products</h2>
                    <div id="featuredProducts" class="row g-4"></div>
                </div>
            </section>
        </div>

        <!-- Products Page -->
        <div id="productsPage" style="display: none;">
            <div class="container mt-5">
                <div class="row">
                    <!-- Filters Sidebar -->
                    <div class="col-lg-3">
                        <div class="filter-section" data-aos="fade-right">
                            <h5 class="mb-3">Filters</h5>
                            
                            <div class="mb-4">
                                <label class="form-label fw-bold">Categories</label>
                                <div id="categoryFilters"></div>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-bold">Price Range</label>
                                <div class="input-group mb-2">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="minPrice" placeholder="Min">
                                </div>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="maxPrice" placeholder="Max">
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-bold">Sort By</label>
                                <select class="form-select" id="sortBy">
                                    <option value="createdAt-DESC">Newest First</option>
                                    <option value="price-ASC">Price: Low to High</option>
                                    <option value="price-DESC">Price: High to Low</option>
                                    <option value="name-ASC">Name: A-Z</option>
                                    <option value="soldQuantity-DESC">Best Selling</option>
                                </select>
                            </div>

                            <button class="btn btn-primary w-100" onclick="applyFilters()">Apply Filters</button>
                            <button class="btn btn-outline-secondary w-100 mt-2" onclick="clearFilters()">Clear</button>
                        </div>
                    </div>

                    <!-- Products Grid -->
                    <div class="col-lg-9">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4 id="productsCount">All Products</h4>
                            <div>
                                <button class="btn btn-sm btn-outline-secondary" onclick="changeView('grid')">
                                    <i class="fas fa-th"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="changeView('list')">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                        </div>
                        <div id="productsList" class="row g-4"></div>
                        <div id="pagination" class="mt-4 d-flex justify-content-center"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profilePage" style="display: none;">
            <div class="container mt-5">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <i class="fas fa-user-circle fa-5x text-primary mb-3"></i>
                                <h5 id="profileName"></h5>
                                <p class="text-muted" id="profileEmail"></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div class="card">
                            <div class="card-header">
                                <h5>Profile Information</h5>
                            </div>
                            <div class="card-body">
                                <form id="profileForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">First Name</label>
                                            <input type="text" class="form-control" id="profileFirstName">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Last Name</label>
                                            <input type="text" class="form-control" id="profileLastName">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" id="profileEmailInput" disabled>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Update Profile</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Orders Page -->
        <div id="ordersPage" style="display: none;">
            <div class="container mt-5">
                <h2 class="mb-4">My Orders</h2>
                <div id="ordersList"></div>
            </div>
        </div>

        <!-- Notifications Page -->
        <div id="notificationsPage" style="display: none;">
            <div class="container mt-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Notifications</h2>
                    <button class="btn btn-sm btn-outline-primary" onclick="markAllRead()">Mark All Read</button>
                </div>
                <div id="notificationsList"></div>
            </div>
        </div>

        <!-- Seller Dashboard -->
        <div id="sellerPage" style="display: none;">
            <div class="container mt-5">
                <h2 class="mb-4"><i class="fas fa-store me-2"></i>Seller Dashboard</h2>
                
                <!-- Seller Stats -->
                <div class="row mb-4" data-aos="fade-up">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 class="text-primary" id="sellerTotalProducts">0</h3>
                                <p class="text-muted mb-0">Total Products</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 class="text-success" id="sellerTotalRevenue">$0</h3>
                                <p class="text-muted mb-0">Total Revenue</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 class="text-info" id="sellerTotalOrders">0</h3>
                                <p class="text-muted mb-0">Total Orders</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 class="text-warning" id="sellerAvgRating">0.0</h3>
                                <p class="text-muted mb-0">Avg Rating</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="mb-4">
                    <button class="btn btn-primary" onclick="showAddProductModal()">
                        <i class="fas fa-plus me-2"></i>Add New Product
                    </button>
                </div>

                <!-- Products List -->
                <div class="card">
                    <div class="card-header">
                        <h5>My Products</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Name</th>
                                        <th>Price</th>
                                        <th>Stock</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="sellerProductsList"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPage" style="display: none;">
            <div class="container mt-5">
                <h2 class="mb-4"><i class="fas fa-shield-alt me-2"></i>Admin Panel</h2>

                <!-- Admin Stats -->
                <div class="row mb-4" data-aos="fade-up">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 class="text-primary" id="adminTotalUsers">0</h3>
                                <p class="text-muted mb-0">Total Users</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 class="text-success" id="adminTotalRevenue">$0</h3>
                                <p class="text-muted mb-0">Total Revenue</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 class="text-info" id="adminTotalOrders">0</h3>
                                <p class="text-muted mb-0">Total Orders</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 class="text-warning" id="adminTotalProducts">0</h3>
                                <p class="text-muted mb-0">Total Products</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Tabs -->
                <ul class="nav nav-tabs mb-4" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="categories-tab" data-bs-toggle="tab" data-bs-target="#categories" type="button">
                            Categories
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="products-tab" data-bs-toggle="tab" data-bs-target="#products" type="button">
                            Products
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders" type="button">
                            Orders
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button">
                            Reviews
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="coupons-tab" data-bs-toggle="tab" data-bs-target="#coupons" type="button">
                            Coupons
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button">
                            Users
                        </button>
                    </li>
                </ul>

                <div class="tab-content">
                    <!-- Categories Tab -->
                    <div class="tab-pane fade show active" id="categories" role="tabpanel">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Manage Categories</h5>
                                <button class="btn btn-sm btn-primary" onclick="showAddCategoryModal()">
                                    <i class="fas fa-plus me-2"></i>Add Category
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Slug</th>
                                                <th>Products</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminCategoriesList"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Products Tab -->
                    <div class="tab-pane fade" id="products" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <h5>All Products</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Image</th>
                                                <th>Name</th>
                                                <th>Seller</th>
                                                <th>Price</th>
                                                <th>Stock</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminProductsList"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Orders Tab -->
                    <div class="tab-pane fade" id="orders" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <h5>All Orders</h5>
                            </div>
                            <div class="card-body">
                                <div id="adminOrdersList"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Reviews Tab -->
                    <div class="tab-pane fade" id="reviews" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <h5>Pending Reviews</h5>
                            </div>
                            <div class="card-body">
                                <div id="adminReviewsList"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Coupons Tab -->
                    <div class="tab-pane fade" id="coupons" role="tabpanel">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Manage Coupons</h5>
                                <button class="btn btn-sm btn-primary" onclick="showAddCouponModal()">
                                    <i class="fas fa-plus me-2"></i>Add Coupon
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Code</th>
                                                <th>Discount</th>
                                                <th>Type</th>
                                                <th>Used/Max</th>
                                                <th>Expires</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminCouponsList"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Users Tab -->
                    <div class="tab-pane fade" id="users" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <h5>All Users</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Role</th>
                                                <th>Joined</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminUsersList"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="loginEmail" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <span id="loginBtnText">Login</span>
                            <span id="loginSpinner" style="display: none;" class="loading-spinner"></span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Account</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="registerForm">
                        <div class="mb-3">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-control" id="regFirstName" required minlength="3">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="regLastName" required minlength="3">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="regEmail" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="regPassword" required minlength="8">
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Create Account</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productModalTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="productModalBody"></div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal fade" id="cartModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Shopping Cart</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="cartItems"></div>
                    <div class="mt-4">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="couponCode" placeholder="Coupon code">
                            <button class="btn btn-outline-secondary" onclick="applyCoupon()">Apply</button>
                        </div>
                        <div id="cartSummary" class="checkout-summary"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continue Shopping</button>
                    <button type="button" class="btn btn-primary" onclick="checkout()">Proceed to Checkout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div class="modal fade" id="productFormModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productFormTitle">Add Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <input type="hidden" id="productId">
                        <div class="mb-3">
                            <label class="form-label">Product Name *</label>
                            <input type="text" class="form-control" id="productName" required minlength="3" maxlength="200">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description *</label>
                            <textarea class="form-control" id="productDescription" rows="4" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Price ($) *</label>
                                <input type="number" class="form-control" id="productPrice" step="0.01" min="0" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Stock Quantity *</label>
                                <input type="number" class="form-control" id="productStock" min="0" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">SKU</label>
                                <input type="text" class="form-control" id="productSku" placeholder="Optional">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Category *</label>
                                <select class="form-select" id="productCategory" required></select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="productStatus">
                                <option value="DRAFT">Draft</option>
                                <option value="PUBLISHED">Published</option>
                                <option value="ARCHIVED">Archived</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Product Images (URLs, comma-separated)</label>
                            <textarea class="form-control" id="productImages" rows="2" placeholder="https://example.com/image1.jpg, https://example.com/image2.jpg"></textarea>
                            <small class="text-muted">Enter image URLs separated by commas</small>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span id="productFormBtnText">Save Product</span>
                            <span id="productFormSpinner" style="display: none;" class="loading-spinner"></span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal fade" id="categoryFormModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="categoryForm">
                        <div class="mb-3">
                            <label class="form-label">Category Name *</label>
                            <input type="text" class="form-control" id="categoryName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Slug *</label>
                            <input type="text" class="form-control" id="categorySlug" required>
                            <small class="text-muted">URL-friendly name (e.g., electronics, home-garden)</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="categoryDescription" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Create Category</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Coupon Modal -->
    <div class="modal fade" id="couponFormModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Coupon</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="couponForm">
                        <div class="mb-3">
                            <label class="form-label">Coupon Code *</label>
                            <input type="text" class="form-control" id="couponCodeInput" required minlength="4" maxlength="20">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Discount Value *</label>
                                <input type="number" class="form-control" id="couponValue" step="0.01" min="0" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Discount Type *</label>
                                <select class="form-select" id="couponType" required>
                                    <option value="PERCENTAGE">Percentage (%)</option>
                                    <option value="FIXED">Fixed Amount ($)</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Max Uses *</label>
                                <input type="number" class="form-control" id="couponMaxUses" min="1" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Max Uses Per User *</label>
                                <input type="number" class="form-control" id="couponMaxUsesPerUser" min="1" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Expiry Date *</label>
                            <input type="datetime-local" class="form-control" id="couponExpiry" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Minimum Order Amount</label>
                            <input type="number" class="form-control" id="couponMinAmount" step="0.01" min="0">
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="couponPublic" checked>
                            <label class="form-check-label" for="couponPublic">Public (visible to all users)</label>
                        </div>
                        <button type="submit" class="btn btn-primary">Create Coupon</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Order Status Modal -->
    <div class="modal fade" id="orderStatusModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Order Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="orderStatusForm">
                        <input type="hidden" id="orderStatusId">
                        <div class="mb-3">
                            <label class="form-label">Status *</label>
                            <select class="form-select" id="orderStatus" required>
                                <option value="PENDING">Pending</option>
                                <option value="CONFIRMED">Confirmed</option>
                                <option value="PROCESSING">Processing</option>
                                <option value="SHIPPED">Shipped</option>
                                <option value="DELIVERED">Delivered</option>
                                <option value="CANCELLED">Cancelled</option>
                                <option value="REFUNDED">Refunded</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Reason/Note</label>
                            <textarea class="form-control" id="orderStatusReason" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Update Status</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h5><i class="fas fa-store me-2"></i>Premium Store</h5>
                    <p class="text-muted">Your trusted e-commerce platform with premium products and excellent service.</p>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white-50">About Us</a></li>
                        <li><a href="#" class="text-white-50">Contact</a></li>
                        <li><a href="#" class="text-white-50">Terms & Conditions</a></li>
                        <li><a href="#" class="text-white-50">Privacy Policy</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>Contact Us</h5>
                    <p class="text-muted">
                        <i class="fas fa-envelope me-2"></i>support@premiumstore.com<br>
                        <i class="fas fa-phone me-2"></i>+1 (555) 123-4567
                    </p>
                    <div class="mt-3">
                        <a href="#" class="text-white me-3"><i class="fab fa-facebook fa-lg"></i></a>
                        <a href="#" class="text-white me-3"><i class="fab fa-twitter fa-lg"></i></a>
                        <a href="#" class="text-white me-3"><i class="fab fa-instagram fa-lg"></i></a>
                    </div>
                </div>
            </div>
            <hr class="bg-white">
            <div class="text-center text-muted">
                <p>&copy; 2026 Premium Store. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- External JS Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script>
        // Configuration
        const API_BASE = 'http://localhost:3000/api/v1';
        let currentUser = null;
        let cart = null;
        let currentPage = 1;
        let currentFilters = {};

        // Initialize AOS
        AOS.init({
            duration: 800,
            once: true
        });

        // Initialize App
        document.addEventListener('DOMContentLoaded', async () => {
            checkAuth();
            await loadCategories();
            await loadFeaturedProducts();
            
            // Event Listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('profileForm').addEventListener('submit', handleUpdateProfile);
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchProducts();
            });
        });

        // Authentication Functions
        function checkAuth() {
            const token = localStorage.getItem('token');
            if (token) {
                fetchUserProfile();
            }
        }

        async function fetchUserProfile() {
            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    currentUser = await response.json();
                    updateAuthUI();
                    await loadCart();
                } else {
                    localStorage.removeItem('token');
                }
            } catch (error) {
                console.error('Error fetching profile:', error);
            }
        }

        function updateAuthUI() {
            if (currentUser) {
                document.getElementById('userMenu').style.display = 'block';
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('profileName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
                document.getElementById('profileEmail').textContent = currentUser.email;
                
                // Show seller menu if user is SELLER or ADMIN
                if (currentUser.role === 'SELLER' || currentUser.role === 'ADMIN') {
                    document.getElementById('sellerMenuItem').style.display = 'block';
                    document.getElementById('sellerMenuLink').style.display = 'block';
                }
                
                // Show admin menu if user is ADMIN
                if (currentUser.role === 'ADMIN') {
                    document.getElementById('adminMenuItem').style.display = 'block';
                    document.getElementById('adminMenuLink').style.display = 'block';
                }
            } else {
                document.getElementById('userMenu').style.display = 'none';
                document.getElementById('authButtons').style.display = 'block';
                document.getElementById('sellerMenuItem').style.display = 'none';
                document.getElementById('sellerMenuLink').style.display = 'none';
                document.getElementById('adminMenuItem').style.display = 'none';
                document.getElementById('adminMenuLink').style.display = 'none';
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            showLoading('loginBtnText', 'loginSpinner');

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('token', data.accessToken);
                    bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
                    await fetchUserProfile();
                    showNotification('Login successful!', 'success');
                } else {
                    const error = await response.json();
                    showNotification(error.message || 'Login failed', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            } finally {
                hideLoading('loginBtnText', 'loginSpinner');
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const data = {
                firstName: document.getElementById('regFirstName').value,
                lastName: document.getElementById('regLastName').value,
                email: document.getElementById('regEmail').value,
                password: document.getElementById('regPassword').value
            };

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('registerModal')).hide();
                    showNotification('Registration successful! Please login.', 'success');
                    setTimeout(() => showLoginModal(), 500);
                } else {
                    const error = await response.json();
                    showNotification(error.message || 'Registration failed', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        }

        function logout() {
            localStorage.removeItem('token');
            currentUser = null;
            cart = null;
            updateAuthUI();
            updateCartCount(0);
            showPage('home');
            showNotification('Logged out successfully', 'success');
        }

        // Categories
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories`);
                const categories = await response.json();
                
                // Home page categories
                const homeHTML = categories.map(cat => 
                    `<span class="category-pill" onclick="filterByCategory('${cat.id}')">${cat.name}</span>`
                ).join('');
                document.getElementById('categoriesHome').innerHTML = homeHTML;

                // Filters sidebar
                const filterHTML = categories.map(cat => `
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="${cat.id}" id="cat-${cat.id}">
                        <label class="form-check-label" for="cat-${cat.id}">${cat.name}</label>
                    </div>
                `).join('');
                document.getElementById('categoryFilters').innerHTML = filterHTML;
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        // Products
        async function loadFeaturedProducts() {
            try {
                const response = await fetch(`${API_BASE}/products?limit=8&status=PUBLISHED`);
                const data = await response.json();
                const products = data.data || data;
                
                const html = products.map(product => createProductCard(product)).join('');
                document.getElementById('featuredProducts').innerHTML = html;
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        async function loadProducts(page = 1, filters = {}) {
            const params = new URLSearchParams({
                page,
                limit: 12,
                status: 'PUBLISHED',
                ...filters
            });

            try {
                const response = await fetch(`${API_BASE}/products?${params}`);
                const data = await response.json();
                
                const products = data.data || data;
                const total = data.total || products.length;
                
                const html = products.map(product => createProductCard(product)).join('');
                document.getElementById('productsList').innerHTML = html;
                document.getElementById('productsCount').textContent = `${total} Products`;
                
                createPagination(page, Math.ceil(total / 12));
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('productsList').innerHTML = 
                    '<div class="col-12 text-center py-5"><p>Error loading products</p></div>';
            }
        }

        function createProductCard(product) {
            const imageUrl = product.images?.[0] || 'https://via.placeholder.com/300x250?text=No+Image';
            const rating = product.averageRating || 0;
            
            return `
                <div class="col-md-4" data-aos="fade-up">
                    <div class="card product-card h-100">
                        <img src="${imageUrl}" class="card-img-top product-image" alt="${product.name}" 
                             onerror="this.src='https://via.placeholder.com/300x250?text=No+Image'">
                        <div class="card-body d-flex flex-column">
                            <h6 class="card-title">${product.name}</h6>
                            <p class="card-text text-muted small">${truncate(product.description, 80)}</p>
                            <div class="mt-auto">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="price-tag">$${product.price}</span>
                                    <div class="star-rating">
                                        ${createStars(rating)}
                                        <small class="text-muted ms-1">(${product.reviewCount || 0})</small>
                                    </div>
                                </div>
                                ${product.stockQuantity > 0 ? 
                                    `<button class="btn btn-primary w-100" onclick="addToCart('${product.id}')">
                                        <i class="fas fa-cart-plus me-2"></i>Add to Cart
                                    </button>` :
                                    `<button class="btn btn-secondary w-100" disabled>Out of Stock</button>`
                                }
                                <button class="btn btn-outline-primary w-100 mt-2" onclick="showProductDetail('${product.id}')">
                                    View Details
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function showProductDetail(productId) {
            try {
                const response = await fetch(`${API_BASE}/products/${productId}`);
                const product = await response.json();
                
                const reviewsResponse = await fetch(`${API_BASE}/reviews/product/${productId}?limit=5`);
                const reviews = await reviewsResponse.json();
                
                const imageUrl = product.images?.[0] || 'https://via.placeholder.com/400?text=No+Image';
                
                document.getElementById('productModalTitle').textContent = product.name;
                document.getElementById('productModalBody').innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <img src="${imageUrl}" class="img-fluid rounded" alt="${product.name}"
                                 onerror="this.src='https://via.placeholder.com/400?text=No+Image'">
                        </div>
                        <div class="col-md-6">
                            <h3 class="price-tag mb-3">$${product.price}</h3>
                            <div class="mb-3">
                                ${createStars(product.averageRating || 0)}
                                <span class="ms-2">${product.reviewCount || 0} reviews</span>
                            </div>
                            <p>${product.description}</p>
                            <p class="text-muted">SKU: ${product.sku || 'N/A'}</p>
                            <p class="${product.stockQuantity > 0 ? 'text-success' : 'text-danger'}">
                                ${product.stockQuantity > 0 ? `${product.stockQuantity} in stock` : 'Out of stock'}
                            </p>
                            ${product.stockQuantity > 0 ? 
                                `<button class="btn btn-primary btn-lg w-100" onclick="addToCart('${product.id}'); bootstrap.Modal.getInstance(document.getElementById('productModal')).hide();">
                                    <i class="fas fa-cart-plus me-2"></i>Add to Cart
                                </button>` :
                                `<button class="btn btn-secondary btn-lg w-100" disabled>Out of Stock</button>`
                            }
                        </div>
                    </div>
                    <hr class="my-4">
                    <h5>Customer Reviews</h5>
                    <div id="productReviews">
                        ${reviews.data?.length ? reviews.data.map(review => `
                            <div class="mb-3 p-3 border rounded">
                                <div class="d-flex justify-content-between">
                                    <strong>${review.user?.firstName || 'Anonymous'}</strong>
                                    <small class="text-muted">${new Date(review.createdAt).toLocaleDateString()}</small>
                                </div>
                                <div class="star-rating my-1">${createStars(review.rating)}</div>
                                <p class="mb-0">${review.comment}</p>
                            </div>
                        `).join('') : '<p class="text-muted">No reviews yet</p>'}
                    </div>
                `;
                
                new bootstrap.Modal(document.getElementById('productModal')).show();
            } catch (error) {
                console.error('Error loading product:', error);
                showNotification('Error loading product details', 'danger');
            }
        }

        // Cart Functions
        async function loadCart() {
            if (!currentUser) return;

            try {
                const response = await fetch(`${API_BASE}/cart`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    cart = await response.json();
                    updateCartCount(cart.items?.length || 0);
                }
            } catch (error) {
                console.error('Error loading cart:', error);
            }
        }

        async function addToCart(productId, quantity = 1) {
            if (!currentUser) {
                showLoginModal();
                showNotification('Please login to add items to cart', 'warning');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/cart/add`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ productId, quantity })
                });

                if (response.ok) {
                    await loadCart();
                    showNotification('Added to cart!', 'success');
                } else {
                    const error = await response.json();
                    showNotification(error.message || 'Failed to add to cart', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        }

        async function updateCartItem(itemId, quantity) {
            try {
                const response = await fetch(`${API_BASE}/cart/update`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ itemId, quantity })
                });

                if (response.ok) {
                    await loadCart();
                    displayCart();
                }
            } catch (error) {
                console.error('Error updating cart:', error);
            }
        }

        async function removeCartItem(itemId) {
            try {
                const response = await fetch(`${API_BASE}/cart/item/${itemId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    await loadCart();
                    displayCart();
                    showNotification('Item removed from cart', 'success');
                }
            } catch (error) {
                console.error('Error removing item:', error);
            }
        }

        async function applyCoupon() {
            const code = document.getElementById('couponCode').value;
            if (!code) return;

            try {
                const response = await fetch(`${API_BASE}/cart/coupon`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ code })
                });

                if (response.ok) {
                    await loadCart();
                    displayCart();
                    showNotification('Coupon applied!', 'success');
                } else {
                    const error = await response.json();
                    showNotification(error.message || 'Invalid coupon', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        }

        function showCart() {
            if (!currentUser) {
                showLoginModal();
                return;
            }
            displayCart();
            new bootstrap.Modal(document.getElementById('cartModal')).show();
        }

        function displayCart() {
            if (!cart || !cart.items?.length) {
                document.getElementById('cartItems').innerHTML = 
                    '<p class="text-center text-muted py-5">Your cart is empty</p>';
                document.getElementById('cartSummary').innerHTML = '';
                return;
            }

            const itemsHTML = cart.items.map(item => `
                <div class="cart-item">
                    <div class="row align-items-center">
                        <div class="col-md-2">
                            <img src="${item.product?.images?.[0] || 'https://via.placeholder.com/80'}" 
                                 class="img-fluid rounded" alt="${item.product?.name}">
                        </div>
                        <div class="col-md-4">
                            <h6>${item.product?.name}</h6>
                            <p class="text-muted mb-0">$${item.product?.price}</p>
                        </div>
                        <div class="col-md-3">
                            <div class="input-group input-group-sm">
                                <button class="btn btn-outline-secondary" onclick="updateCartItem('${item.id}', ${item.quantity - 1})">-</button>
                                <input type="text" class="form-control text-center" value="${item.quantity}" readonly>
                                <button class="btn btn-outline-secondary" onclick="updateCartItem('${item.id}', ${item.quantity + 1})">+</button>
                            </div>
                        </div>
                        <div class="col-md-2 text-end">
                            <strong>$${(item.product?.price * item.quantity).toFixed(2)}</strong>
                        </div>
                        <div class="col-md-1 text-end">
                            <button class="btn btn-sm btn-outline-danger" onclick="removeCartItem('${item.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            const subtotal = cart.items.reduce((sum, item) => sum + (item.product?.price * item.quantity), 0);
            const discount = cart.discount || 0;
            const total = subtotal - discount;

            document.getElementById('cartItems').innerHTML = itemsHTML;
            document.getElementById('cartSummary').innerHTML = `
                <div class="d-flex justify-content-between mb-2">
                    <span>Subtotal:</span>
                    <strong>$${subtotal.toFixed(2)}</strong>
                </div>
                ${discount > 0 ? `
                    <div class="d-flex justify-content-between mb-2 text-success">
                        <span>Discount:</span>
                        <strong>-$${discount.toFixed(2)}</strong>
                    </div>
                ` : ''}
                <hr>
                <div class="d-flex justify-content-between">
                    <h5>Total:</h5>
                    <h5>$${total.toFixed(2)}</h5>
                </div>
            `;
        }

        async function checkout() {
            if (!cart || !cart.items?.length) return;

            const items = cart.items.map(item => ({
                productId: item.productId,
                quantity: item.quantity
            }));

            try {
                const response = await fetch(`${API_BASE}/orders`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ items })
                });

                if (response.ok) {
                    const order = await response.json();
                    bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
                    await loadCart();
                    showNotification('Order placed successfully!', 'success');
                    showPage('orders');
                } else {
                    const error = await response.json();
                    showNotification(error.message || 'Checkout failed', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        }

        // Orders
        async function loadOrders() {
            try {
                const response = await fetch(`${API_BASE}/orders`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const orders = await response.json();
                    displayOrders(orders.data || orders);
                }
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        function displayOrders(orders) {
            if (!orders?.length) {
                document.getElementById('ordersList').innerHTML = 
                    '<div class="text-center py-5"><p class="text-muted">No orders yet</p></div>';
                return;
            }

            const html = orders.map(order => `
                <div class="card mb-3" data-aos="fade-up">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="mb-0">Order #${order.id.substring(0, 8)}</h6>
                                <small class="text-muted">${new Date(order.createdAt).toLocaleDateString()}</small>
                            </div>
                            <div class="col-md-4 text-end">
                                <span class="badge bg-primary">${order.status}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="order-timeline">
                            ${order.items?.map(item => `
                                <div class="timeline-item">
                                    <div class="timeline-dot"></div>
                                    <strong>${item.product?.name}</strong> x ${item.quantity}
                                    <span class="float-end">$${(item.price * item.quantity).toFixed(2)}</span>
                                </div>
                            `).join('') || ''}
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between">
                            <h5>Total:</h5>
                            <h5>$${order.totalAmount?.toFixed(2)}</h5>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('ordersList').innerHTML = html;
        }

        // Notifications
        async function loadNotifications() {
            try {
                const response = await fetch(`${API_BASE}/notifications?page=1&limit=20`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayNotifications(data.data || data);
                }
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }

        function displayNotifications(notifications) {
            if (!notifications?.length) {
                document.getElementById('notificationsList').innerHTML = 
                    '<div class="text-center py-5"><p class="text-muted">No notifications</p></div>';
                return;
            }

            const html = notifications.map(notif => `
                <div class="card mb-2 ${notif.isRead ? '' : 'border-primary'}" data-aos="fade-up">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6>${notif.title}</h6>
                                <p class="mb-1">${notif.message}</p>
                                <small class="text-muted">${new Date(notif.createdAt).toLocaleString()}</small>
                            </div>
                            ${!notif.isRead ? 
                                `<button class="btn btn-sm btn-primary" onclick="markNotificationRead('${notif.id}')">
                                    Mark Read
                                </button>` : ''
                            }
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('notificationsList').innerHTML = html;
        }

        async function markNotificationRead(id) {
            try {
                await fetch(`${API_BASE}/notifications/${id}/read`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                loadNotifications();
            } catch (error) {
                console.error('Error marking notification as read:', error);
            }
        }

        async function markAllRead() {
            try {
                await fetch(`${API_BASE}/notifications/read-all`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                loadNotifications();
                showNotification('All notifications marked as read', 'success');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Profile
        async function handleUpdateProfile(e) {
            e.preventDefault();
            
            const data = {
                firstName: document.getElementById('profileFirstName').value,
                lastName: document.getElementById('profileLastName').value
            };

            try {
                const response = await fetch(`${API_BASE}/users/${currentUser.id}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    await fetchUserProfile();
                    showNotification('Profile updated successfully', 'success');
                } else {
                    showNotification('Failed to update profile', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        }

        // Search & Filters
        function searchProducts() {
            const query = document.getElementById('searchInput').value;
            if (query) {
                currentFilters.search = query;
                showPage('products');
                loadProducts(1, currentFilters);
            }
        }

        function filterByCategory(categoryId) {
            currentFilters.categoryId = categoryId;
            showPage('products');
            loadProducts(1, currentFilters);
        }

        function applyFilters() {
            const filters = {};
            
            const categories = Array.from(document.querySelectorAll('#categoryFilters input:checked'))
                .map(cb => cb.value);
            if (categories.length > 0) filters.categoryId = categories[0];

            const minPrice = document.getElementById('minPrice').value;
            if (minPrice) filters.minPrice = minPrice;

            const maxPrice = document.getElementById('maxPrice').value;
            if (maxPrice) filters.maxPrice = maxPrice;

            const sortBy = document.getElementById('sortBy').value.split('-');
            if (sortBy.length === 2) {
                filters.sortBy = sortBy[0];
                filters.sortOrder = sortBy[1];
            }

            currentFilters = filters;
            loadProducts(1, currentFilters);
        }

        function clearFilters() {
            document.querySelectorAll('#categoryFilters input').forEach(cb => cb.checked = false);
            document.getElementById('minPrice').value = '';
            document.getElementById('maxPrice').value = '';
            document.getElementById('sortBy').value = 'createdAt-DESC';
            currentFilters = {};
            loadProducts(1, currentFilters);
        }

        // Navigation
        function showPage(page) {
            document.querySelectorAll('#mainContent > div').forEach(div => div.style.display = 'none');
            
            switch(page) {
                case 'home':
                    document.getElementById('homePage').style.display = 'block';
                    break;
                case 'products':
                    document.getElementById('productsPage').style.display = 'block';
                    loadProducts(1, currentFilters);
                    break;
                case 'profile':
                    if (!currentUser) {
                        showLoginModal();
                        return;
                    }
                    document.getElementById('profilePage').style.display = 'block';
                    document.getElementById('profileFirstName').value = currentUser.firstName;
                    document.getElementById('profileLastName').value = currentUser.lastName;
                    document.getElementById('profileEmailInput').value = currentUser.email;
                    break;
                case 'orders':
                    if (!currentUser) {
                        showLoginModal();
                        return;
                    }
                    document.getElementById('ordersPage').style.display = 'block';
                    loadOrders();
                    break;
                case 'notifications':
                    if (!currentUser) {
                        showLoginModal();
                        return;
                    }
                    document.getElementById('notificationsPage').style.display = 'block';
                    loadNotifications();
                    break;
                case 'seller':
                    if (!currentUser || (currentUser.role !== 'SELLER' && currentUser.role !== 'ADMIN')) {
                        showNotification('Access denied', 'danger');
                        return;
                    }
                    document.getElementById('sellerPage').style.display = 'block';
                    loadSellerDashboard();
                    break;
                case 'admin':
                    if (!currentUser || currentUser.role !== 'ADMIN') {
                        showNotification('Access denied', 'danger');
                        return;
                    }
                    document.getElementById('adminPage').style.display = 'block';
                    loadAdminDashboard();
                    break;
            }
            
            window.scrollTo(0, 0);
        }

        // UI Helpers
        function showLoginModal() {
            new bootstrap.Modal(document.getElementById('loginModal')).show();
        }

        function showRegisterModal() {
            new bootstrap.Modal(document.getElementById('registerModal')).show();
        }

        function updateCartCount(count) {
            document.getElementById('cartCount').textContent = count;
        }

        function showNotification(message, type = 'info') {
            const id = Date.now();
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show notification animate__animated animate__fadeInRight`;
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            notification.id = `notif-${id}`;
            
            document.getElementById('notificationContainer').appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('animate__fadeInRight');
                notification.classList.add('animate__fadeOutRight');
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        function showLoading(textId, spinnerId) {
            document.getElementById(textId).style.display = 'none';
            document.getElementById(spinnerId).style.display = 'inline-block';
        }

        function hideLoading(textId, spinnerId) {
            document.getElementById(textId).style.display = 'inline';
            document.getElementById(spinnerId).style.display = 'none';
        }

        function createStars(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
            
            return ''.repeat(fullStars) + 
                   (halfStar ? '' : '') + 
                   ''.repeat(emptyStars);
        }

        function truncate(str, len) {
            return str.length > len ? str.substring(0, len) + '...' : str;
        }

        function createPagination(currentPage, totalPages) {
            if (totalPages <= 1) {
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            let html = '<nav><ul class="pagination">';
            
            if (currentPage > 1) {
                html += `<li class="page-item"><a class="page-link" href="#" onclick="loadProducts(${currentPage - 1}, currentFilters)">Previous</a></li>`;
            }
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    html += `<li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="loadProducts(${i}, currentFilters)">${i}</a>
                    </li>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    html += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }
            
            if (currentPage < totalPages) {
                html += `<li class="page-item"><a class="page-link" href="#" onclick="loadProducts(${currentPage + 1}, currentFilters)">Next</a></li>`;
            }
            
            html += '</ul></nav>';
            document.getElementById('pagination').innerHTML = html;
        }

        function changeView(view) {
            // Implementation for grid/list view toggle
            showNotification(`Switched to ${view} view`, 'info');
        }

        // ============================================
        // SELLER DASHBOARD FUNCTIONS
        // ============================================

        async function loadSellerDashboard() {
            await loadSellerStats();
            await loadSellerProducts();
            await loadCategoriesForForm();
        }

        async function loadSellerStats() {
            try {
                const response = await fetch(`${API_BASE}/seller/analytics`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('sellerTotalProducts').textContent = stats.totalProducts || 0;
                    document.getElementById('sellerTotalRevenue').textContent = `$${(stats.totalRevenue || 0).toFixed(2)}`;
                    document.getElementById('sellerTotalOrders').textContent = stats.totalOrders || 0;
                    document.getElementById('sellerAvgRating').textContent = (stats.averageRating || 0).toFixed(1);
                }
            } catch (error) {
                console.error('Error loading seller stats:', error);
            }
        }

        async function loadSellerProducts() {
            try {
                const response = await fetch(`${API_BASE}/seller/products`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const products = await response.json();
                    displaySellerProducts(products.data || products);
                }
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        function displaySellerProducts(products) {
            if (!products?.length) {
                document.getElementById('sellerProductsList').innerHTML = 
                    '<tr><td colspan="6" class="text-center text-muted">No products yet</td></tr>';
                return;
            }

            const html = products.map(product => `
                <tr>
                    <td>
                        <img src="${product.images?.[0] || 'https://via.placeholder.com/50'}" 
                             alt="${product.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                    </td>
                    <td>${product.name}</td>
                    <td>$${product.price}</td>
                    <td>${product.stockQuantity}</td>
                    <td><span class="badge bg-${product.status === 'PUBLISHED' ? 'success' : 'secondary'}">${product.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editProduct('${product.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct('${product.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('sellerProductsList').innerHTML = html;
        }

        async function loadCategoriesForForm() {
            try {
                const response = await fetch(`${API_BASE}/categories`);
                const categories = await response.json();
                
                const options = categories.map(cat => 
                    `<option value="${cat.id}">${cat.name}</option>`
                ).join('');
                
                document.getElementById('productCategory').innerHTML = options;
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        function showAddProductModal() {
            document.getElementById('productFormTitle').textContent = 'Add Product';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            new bootstrap.Modal(document.getElementById('productFormModal')).show();
        }

        async function editProduct(productId) {
            try {
                const response = await fetch(`${API_BASE}/products/${productId}`);
                if (response.ok) {
                    const product = await response.json();
                    
                    document.getElementById('productFormTitle').textContent = 'Edit Product';
                    document.getElementById('productId').value = product.id;
                    document.getElementById('productName').value = product.name;
                    document.getElementById('productDescription').value = product.description;
                    document.getElementById('productPrice').value = product.price;
                    document.getElementById('productStock').value = product.stockQuantity;
                    document.getElementById('productSku').value = product.sku || '';
                    document.getElementById('productCategory').value = product.categoryId;
                    document.getElementById('productStatus').value = product.status;
                    document.getElementById('productImages').value = product.images?.join(', ') || '';
                    
                    new bootstrap.Modal(document.getElementById('productFormModal')).show();
                }
            } catch (error) {
                console.error('Error loading product:', error);
            }
        }

        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const productId = document.getElementById('productId').value;
            const images = document.getElementById('productImages').value
                .split(',')
                .map(url => url.trim())
                .filter(url => url);
            
            const data = {
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stockQuantity: parseInt(document.getElementById('productStock').value),
                sku: document.getElementById('productSku').value || undefined,
                categoryId: document.getElementById('productCategory').value,
                status: document.getElementById('productStatus').value,
                images: images.length > 0 ? images : undefined
            };

            showLoading('productFormBtnText', 'productFormSpinner');

            try {
                const url = productId ? 
                    `${API_BASE}/seller/products/${productId}` : 
                    `${API_BASE}/seller/products`;
                const method = productId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method,
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('productFormModal')).hide();
                    showNotification(productId ? 'Product updated!' : 'Product created!', 'success');
                    await loadSellerProducts();
                    await loadSellerStats();
                } else {
                    const error = await response.json();
                    showNotification(error.message || 'Failed to save product', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            } finally {
                hideLoading('productFormBtnText', 'productFormSpinner');
            }
        });

        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) return;

            try {
                const response = await fetch(`${API_BASE}/seller/products/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    showNotification('Product deleted', 'success');
                    await loadSellerProducts();
                    await loadSellerStats();
                } else {
                    showNotification('Failed to delete product', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        }

        // ============================================
        // ADMIN DASHBOARD FUNCTIONS
        // ============================================

        async function loadAdminDashboard() {
            await loadAdminStats();
            await loadAdminCategories();
            await loadAdminProducts();
            await loadAdminOrders();
            await loadAdminReviews();
            await loadAdminCoupons();
            await loadAdminUsers();
        }

        async function loadAdminStats() {
            try {
                const response = await fetch(`${API_BASE}/admin/stats`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('adminTotalUsers').textContent = stats.totalUsers || 0;
                    document.getElementById('adminTotalRevenue').textContent = `$${(stats.totalRevenue || 0).toFixed(2)}`;
                    document.getElementById('adminTotalOrders').textContent = stats.totalOrders || 0;
                    document.getElementById('adminTotalProducts').textContent = stats.totalProducts || 0;
                }
            } catch (error) {
                console.error('Error loading admin stats:', error);
            }
        }

        async function loadAdminCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories`);
                const categories = await response.json();
                
                const html = categories.map(cat => `
                    <tr>
                        <td>${cat.name}</td>
                        <td>${cat.slug}</td>
                        <td>${cat.productCount || 0}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteCategory('${cat.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                document.getElementById('adminCategoriesList').innerHTML = html || 
                    '<tr><td colspan="4" class="text-center text-muted">No categories</td></tr>';
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        function showAddCategoryModal() {
            document.getElementById('categoryForm').reset();
            new bootstrap.Modal(document.getElementById('categoryFormModal')).show();
        }

        document.getElementById('categoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                name: document.getElementById('categoryName').value,
                slug: document.getElementById('categorySlug').value,
                description: document.getElementById('categoryDescription').value || undefined
            };

            try {
                const response = await fetch(`${API_BASE}/categories`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('categoryFormModal')).hide();
                    showNotification('Category created!', 'success');
                    await loadAdminCategories();
                    await loadCategories();
                } else {
                    const error = await response.json();
                    showNotification(error.message || 'Failed to create category', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        });

        async function deleteCategory(categoryId) {
            if (!confirm('Delete this category? Products in this category will need reassignment.')) return;

            try {
                const response = await fetch(`${API_BASE}/categories/${categoryId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    showNotification('Category deleted', 'success');
                    await loadAdminCategories();
                } else {
                    showNotification('Failed to delete category', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        }

        async function loadAdminProducts() {
            try {
                const response = await fetch(`${API_BASE}/products?limit=50`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const products = data.data || data;
                    
                    const html = products.map(product => `
                        <tr>
                            <td>
                                <img src="${product.images?.[0] || 'https://via.placeholder.com/50'}" 
                                     alt="${product.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                            </td>
                            <td>${product.name}</td>
                            <td>${product.seller?.firstName || 'N/A'}</td>
                            <td>$${product.price}</td>
                            <td>${product.stockQuantity}</td>
                            <td><span class="badge bg-${product.status === 'PUBLISHED' ? 'success' : 'secondary'}">${product.status}</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-danger" onclick="adminDeleteProduct('${product.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('');
                    
                    document.getElementById('adminProductsList').innerHTML = html || 
                        '<tr><td colspan="7" class="text-center text-muted">No products</td></tr>';
                }
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        async function adminDeleteProduct(productId) {
            if (!confirm('Delete this product? This action cannot be undone.')) return;

            try {
                const response = await fetch(`${API_BASE}/products/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    showNotification('Product deleted', 'success');
                    await loadAdminProducts();
                    await loadAdminStats();
                } else {
                    showNotification('Failed to delete product', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        }

        async function loadAdminOrders() {
            try {
                const response = await fetch(`${API_BASE}/admin/orders`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const orders = await response.json();
                    displayAdminOrders(orders.data || orders);
                }
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        function displayAdminOrders(orders) {
            if (!orders?.length) {
                document.getElementById('adminOrdersList').innerHTML = 
                    '<p class="text-center text-muted">No orders</p>';
                return;
            }

            const html = orders.map(order => `
                <div class="card mb-3">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h6 class="mb-0">Order #${order.id.substring(0, 8)}</h6>
                                <small class="text-muted">${order.user?.email || 'N/A'}</small>
                            </div>
                            <div class="col-md-3">
                                <span class="badge bg-primary">${order.status}</span>
                            </div>
                            <div class="col-md-3 text-end">
                                <button class="btn btn-sm btn-outline-primary" onclick="showOrderStatusModal('${order.id}', '${order.status}')">
                                    Update Status
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="mb-1"><strong>Total:</strong> $${order.totalAmount?.toFixed(2)}</p>
                        <p class="mb-0"><strong>Date:</strong> ${new Date(order.createdAt).toLocaleString()}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('adminOrdersList').innerHTML = html;
        }

        function showOrderStatusModal(orderId, currentStatus) {
            document.getElementById('orderStatusId').value = orderId;
            document.getElementById('orderStatus').value = currentStatus;
            document.getElementById('orderStatusReason').value = '';
            new bootstrap.Modal(document.getElementById('orderStatusModal')).show();
        }

        document.getElementById('orderStatusForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const orderId = document.getElementById('orderStatusId').value;
            const data = {
                status: document.getElementById('orderStatus').value,
                reason: document.getElementById('orderStatusReason').value || undefined
            };

            try {
                const response = await fetch(`${API_BASE}/orders/${orderId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('orderStatusModal')).hide();
                    showNotification('Order status updated!', 'success');
                    await loadAdminOrders();
                } else {
                    const error = await response.json();
                    showNotification(error.message || 'Failed to update status', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        });

        async function loadAdminReviews() {
            try {
                const response = await fetch(`${API_BASE}/reviews?status=PENDING&limit=20`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const reviews = data.data || data;
                    
                    if (!reviews?.length) {
                        document.getElementById('adminReviewsList').innerHTML = 
                            '<p class="text-center text-muted">No pending reviews</p>';
                        return;
                    }

                    const html = reviews.map(review => `
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6>${review.product?.name || 'Unknown Product'}</h6>
                                        <div class="star-rating mb-2">${createStars(review.rating)}</div>
                                        <p>${review.comment}</p>
                                        <small class="text-muted">By ${review.user?.firstName || 'Anonymous'}</small>
                                    </div>
                                    <div>
                                        <button class="btn btn-sm btn-success me-2" onclick="approveReview('${review.id}')">
                                            <i class="fas fa-check"></i> Approve
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="rejectReview('${review.id}')">
                                            <i class="fas fa-times"></i> Reject
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');

                    document.getElementById('adminReviewsList').innerHTML = html;
                }
            } catch (error) {
                console.error('Error loading reviews:', error);
            }
        }

        async function approveReview(reviewId) {
            try {
                const response = await fetch(`${API_BASE}/reviews/${reviewId}/approve`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    showNotification('Review approved!', 'success');
                    await loadAdminReviews();
                } else {
                    showNotification('Failed to approve review', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        }

        async function rejectReview(reviewId) {
            if (!confirm('Reject this review?')) return;

            try {
                const response = await fetch(`${API_BASE}/reviews/${reviewId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    showNotification('Review rejected', 'success');
                    await loadAdminReviews();
                } else {
                    showNotification('Failed to reject review', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        }

        function showAddCouponModal() {
            document.getElementById('couponForm').reset();
            // Set default expiry to 30 days from now
            const date = new Date();
            date.setDate(date.getDate() + 30);
            document.getElementById('couponExpiry').value = date.toISOString().slice(0, 16);
            new bootstrap.Modal(document.getElementById('couponFormModal')).show();
        }

        document.getElementById('couponForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                code: document.getElementById('couponCodeInput').value.toUpperCase(),
                discountValue: parseFloat(document.getElementById('couponValue').value),
                discountType: document.getElementById('couponType').value,
                maxUses: parseInt(document.getElementById('couponMaxUses').value),
                maxUsesPerUser: parseInt(document.getElementById('couponMaxUsesPerUser').value),
                expiresAt: new Date(document.getElementById('couponExpiry').value).toISOString(),
                isPublic: document.getElementById('couponPublic').checked,
                minOrderAmount: parseFloat(document.getElementById('couponMinAmount').value) || undefined
            };

            try {
                const response = await fetch(`${API_BASE}/coupons`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('couponFormModal')).hide();
                    showNotification('Coupon created!', 'success');
                    await loadAdminCoupons();
                } else {
                    const error = await response.json();
                    showNotification(error.message || 'Failed to create coupon', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        });

        async function loadAdminCoupons() {
            try {
                const response = await fetch(`${API_BASE}/coupons`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const coupons = await response.json();
                    
                    const html = (coupons.data || coupons).map(coupon => {
                        const isExpired = new Date(coupon.expiresAt) < new Date();
                        const isMaxed = coupon.usedCount >= coupon.maxUses;
                        
                        return `
                            <tr>
                                <td><strong>${coupon.code}</strong></td>
                                <td>${coupon.discountValue}${coupon.discountType === 'PERCENTAGE' ? '%' : '$'}</td>
                                <td><span class="badge bg-info">${coupon.discountType}</span></td>
                                <td>${coupon.usedCount || 0} / ${coupon.maxUses}</td>
                                <td>${new Date(coupon.expiresAt).toLocaleDateString()}</td>
                                <td>
                                    <span class="badge bg-${isExpired || isMaxed ? 'secondary' : 'success'}">
                                        ${isExpired ? 'Expired' : isMaxed ? 'Max Used' : 'Active'}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteCoupon('${coupon.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                    
                    document.getElementById('adminCouponsList').innerHTML = html || 
                        '<tr><td colspan="7" class="text-center text-muted">No coupons</td></tr>';
                }
            } catch (error) {
                console.error('Error loading coupons:', error);
            }
        }

        async function deleteCoupon(couponId) {
            if (!confirm('Delete this coupon?')) return;

            try {
                const response = await fetch(`${API_BASE}/coupons/${couponId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    showNotification('Coupon deleted', 'success');
                    await loadAdminCoupons();
                } else {
                    showNotification('Failed to delete coupon', 'danger');
                }
            } catch (error) {
                showNotification('Network error', 'danger');
            }
        }

        async function loadAdminUsers() {
            try {
                const response = await fetch(`${API_BASE}/users`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const users = await response.json();
                    
                    const html = (users.data || users).map(user => `
                        <tr>
                            <td>${user.firstName} ${user.lastName}</td>
                            <td>${user.email}</td>
                            <td><span class="badge bg-primary">${user.role}</span></td>
                            <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                            <td>
                                <select class="form-select form-select-sm" onchange="updateUserRole('${user.id}', this.value)" ${user.id === currentUser.id ? 'disabled' : ''}>
                                    <option value="USER" ${user.role === 'USER' ? 'selected' : ''}>User</option>
                                    <option value="SELLER" ${user.role === 'SELLER' ? 'selected' : ''}>Seller</option>
                                    <option value="ADMIN" ${user.role === 'ADMIN' ? 'selected' : ''}>Admin</option>
                                </select>
                            </td>
                        </tr>
                    `).join('');
                    
                    document.getElementById('adminUsersList').innerHTML = html || 
                        '<tr><td colspan="5" class="text-center text-muted">No users</td></tr>';
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        async function updateUserRole(userId, newRole) {
            try {
                const response = await fetch(`${API_BASE}/users/${userId}/role`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ role: newRole })
                });

                if (response.ok) {
                    showNotification('User role updated!', 'success');
                } else {
                    const error = await response.json();
                    showNotification(error.message || 'Failed to update role', 'danger');
                    await loadAdminUsers();
                }
            } catch (error) {
                showNotification('Network error', 'danger');
                await loadAdminUsers();
            }
        }
    </script>
</body>
</html>